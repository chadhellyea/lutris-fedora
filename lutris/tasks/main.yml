---
- name: install the rpmfusion repo packages
  dnf:
    state: present
    name: 
    - http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-{{ fedora_current }}.noarch.rpm
    - http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-{{ fedora_current }}.noarch.rpm

- name: upgrade all packages
  dnf:
    name: "*"
    state: latest

- name: configure and install lutris akmod-nvidia and dependencies for DXVK (Vulcan)
  dnf:
    name: 
      - gnutls
      - gnutls-devel 
      - openldap
      - openldap-devel
      - libgpg-error
      - sqlite2.i686
      - sqlite2.x86_64 
      - lutris
      - akmod-nvidia
    state: latest

- name: disable wayland
  lineinfile:
    path: /etc/gdm/custom.conf
    insertafter: '^\[daemon'
    line: 'WaylandEnable=true'

- name: disable wayland part 2
  lineinfile:
    path: /etc/gdm/custom.conf
    insertafter: '^\[daemon'
    line: 'DefaultSession=gnome-xorg.desktop'
    create: yes

- name: create nouveau blacklist file
  copy:
    dest: /etc/modprobe.d/nouveau.conf
    content: |
      blacklist nouveau

